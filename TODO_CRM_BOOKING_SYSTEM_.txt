# üìã TODO:  –†–∞–∑–≤–∏—Ç–∏–µ —Å–∏—Å—Ç–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

## üéØ –û–±—â–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π CRM-—Å–∏—Å—Ç–µ–º—ã –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, —Å–æ—Å—Ç–æ—è—â–µ–π –∏–∑ –¥–≤—É—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –±–æ—Ç–æ–≤:
1. **bronivik_jr** (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π) ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –Ω–∞ —Ü–µ–ª—ã–π –¥–µ–Ω—å
2. **bronivik_crm** (–Ω–æ–≤—ã–π) ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–æ–≤ –Ω–∞ —á–∞—Å—ã —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

---

# üìå –ß–ê–°–¢–¨ 1: –î–æ—Ä–∞–±–æ—Ç–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±–æ—Ç–∞ (bronivik_jr)

## 1. 1 API Endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è

### 1.1.1 –°–æ–∑–¥–∞–Ω–∏–µ HTTP-—Å–µ—Ä–≤–µ—Ä–∞
- [x] **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `internal/api/server.go`**
  - [x] –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è HTTP-—Å–µ—Ä–≤–µ—Ä–∞ (gin/chi/—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π net/http)
  - [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  - [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
  - [x] Graceful shutdown

- [x] **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `internal/api/handlers. go`**
  - [x] Handler `GET /api/v1/availability/{item_name}? date={date}`
    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∞–ø–ø–∞—Ä–∞—Ç–∞ –ø–æ –∏–º–µ–Ω–∏ –∏ –¥–∞—Ç–µ
    - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:  `{"available": true/false, "booked_count": N, "total":  M}`
  - [x] Handler `GET /api/v1/availability/bulk`
    - –ú–∞—Å—Å–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
    - Body: `{"items": ["item1", "item2"], "dates": ["2025-12-22", "2025-12-23"]}`
  - [x] Handler `GET /api/v1/items`
    - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–ø–ø–∞—Ä–∞—Ç–æ–≤ —Å –∏—Ö total_quantity

### 1.1.2 –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è API
- [x] **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `internal/api/auth.go`**
  - [x] Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API-–∫–ª—é—á–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `X-API-Key`
  - [x] –•—Ä–∞–Ω–µ–Ω–∏–µ API-–∫–ª—é—á–µ–π –≤ –∫–æ–Ω—Ñ–∏–≥–µ –∏–ª–∏ –±–∞–∑–µ
  - [x] Rate limiting –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DDoS

- [x] **–û–±–Ω–æ–≤–∏—Ç—å `configs/config.yaml`**
  ```yaml
  api: 
    enabled: true
    port: 8081
    api_keys:
      - key: "secret-key-for-crm-bot"
        name: "bronivik_crm"
        permissions:  ["read: availability", "read:items"]
  ```

### 1.1.3 –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è database
- [x] **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ –≤ `internal/database/database.go`**
  ```go
  // GetItemAvailabilityByName –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ –∏–º–µ–Ω–∏ –∞–ø–ø–∞—Ä–∞—Ç–∞
  func (db *DB) GetItemAvailabilityByName(ctx context.Context, itemName string, date time.Time) (*AvailabilityInfo, error)
  
  // GetItemByName –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–ø–ø–∞—Ä–∞—Ç –ø–æ –∏–º–µ–Ω–∏
  func (db *DB) GetItemByName(ctx context. Context, name string) (*models.Item, error)
  ```

### 1.1.4 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ main.go
- [x] **–ó–∞–ø—É—Å–∫ API-—Å–µ—Ä–≤–µ—Ä–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å –±–æ—Ç–æ–º**
  ```go
  // –í main.go
  if cfg.API.Enabled {
      apiServer := api.NewServer(cfg, db)
      go apiServer.Start()
  }
  ```

---

## 1.2 –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Google Sheets

### 1.2.1 –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Ç–æ—á–µ—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- [x] **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `internal/google/sheets_simple.go`**
  - [x] –ó–∞–º–µ–Ω–∏—Ç—å `ReplaceBookingsSheet()` –Ω–∞:
    ```go
    // UpsertBooking –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–ª–∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –æ–¥–Ω—É –∑–∞–ø–∏—Å—å
    func (s *SheetsService) UpsertBooking(booking *models.Booking) error
    
    // DeleteBookingRow —É–¥–∞–ª—è–µ—Ç —Å—Ç—Ä–æ–∫—É –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    func (s *SheetsService) DeleteBookingRow(bookingID int64) error
    
    // UpdateBookingStatus –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å –≤ —Å—Ç—Ä–æ–∫–µ
    func (s *SheetsService) UpdateBookingStatus(bookingID int64, status string) error
    ```
  
  - [x] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ —Å—Ç—Ä–æ–∫–∏ –ø–æ ID –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    ```go
    // FindBookingRow –Ω–∞—Ö–æ–¥–∏—Ç –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –ø–æ ID –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
    func (s *SheetsService) FindBookingRow(bookingID int64) (int, error)
    ```

  - [x] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ `booking_id -> row_number` –≤ Redis/memory

### 1.2.2 –°–æ–∑–¥–∞–Ω–∏–µ Worker –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- [x] **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `internal/worker/sheets_worker.go`**
  ```go
  type SheetsWorker struct {
      queue chan SheetTask
      sheetsService *google.SheetsService
      retryPolicy RetryPolicy
  }
  
  type SheetTask struct {
      Type       string // "upsert", "delete", "update_status"
      BookingID  int64
      Booking    *models. Booking
      Status     string
      RetryCount int
      CreatedAt  time. Time
  }
  
  func (w *SheetsWorker) Start(ctx context.Context)
  func (w *SheetsWorker) EnqueueTask(task SheetTask)
  ```
- [x] **–°–æ–∑–¥–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á**
  - [x] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Redis –¥–ª—è –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
  - [x] Fallback –Ω–∞ in-memory queue
  - [x] Retry logic —Å exponential backoff
  - [x] Dead letter queue –¥–ª—è failed tasks
- [x] **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `internal/worker/retry. go`**
  ```go
  type RetryPolicy struct {
      MaxRetries     int
      InitialDelay   time.Duration
      MaxDelay       time.Duration
      BackoffFactor  float64
  }
  
  func (r *RetryPolicy) NextDelay(attempt int) time.Duration
  ```

### 1.2.3 –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- [x] **–î–æ–±–∞–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ `internal/database/database.go`**
  ```sql
  CREATE TABLE IF NOT EXISTS sync_queue (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      task_type TEXT NOT NULL,
      booking_id INTEGER NOT NULL,
      payload TEXT, -- JSON
      status TEXT DEFAULT 'pending', -- pending, processing, completed, failed
      retry_count INTEGER DEFAULT 0,
      last_error TEXT,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      processed_at DATETIME,
      next_retry_at DATETIME
  );
  
  CREATE INDEX IF NOT EXISTS idx_sync_queue_status ON sync_queue(status);
  CREATE INDEX IF NOT EXISTS idx_sync_queue_next_retry ON sync_queue(next_retry_at);
  ```

- [x] **CRUD –º–µ—Ç–æ–¥—ã –¥–ª—è sync_queue**
  ```go
  func (db *DB) CreateSyncTask(ctx context.Context, task *SyncTask) error
  func (db *DB) GetPendingSyncTasks(ctx context.Context, limit int) ([]SyncTask, error)
  func (db *DB) UpdateSyncTaskStatus(ctx context.Context, id int64, status string, err string) error
  func (db *DB) GetFailedSyncTasks(ctx context.Context) ([]SyncTask, error)
  ```

### 1.2.4 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ—Ä–∫–µ—Ä–∞
 - [x] **–ü—Ä–∏–º–µ—Ä –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ `internal/bot/utils.go`**
  ```go
  // –ë—ã–ª–æ: 
  go func() {
      time.Sleep(1 * time.Second)
      b.SyncBookingsToSheets()
  }()
  
  // –°—Ç–∞–ª–æ:
  b.sheetsWorker.EnqueueTask(SheetTask{
      Type:       "upsert",
      BookingID: booking.ID,
      Booking:    &booking,
  })
 [x] **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–ª–æ—Ç–∞**
 [x] **–°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏**
  ```
  - [x] –í–Ω–µ–¥—Ä–µ–Ω–æ: enqueue –≤ finalizeBooking/confirm/reject/reopen/complete –≤–º–µ—Å—Ç–æ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤

---

## 1.3 –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏ data race

### 1.3.1 –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–æ–±–ª–µ–º
- [x] **–í—ã—è–≤–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã, –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ UI**
  - `SyncBookingsToSheets()` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
  - `SyncScheduleToSheets()` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
  - `AppendBookingToSheets()` ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ

### 1.3.2 –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ "Event Sourcing Light"
- [x] **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `internal/events/events.go`**
  ```go
  type Event struct {
      ID        int64
      Type      string // booking_created, booking_confirmed, etc.
      Payload   json.RawMessage
      CreatedAt time.Time
      Processed bool
  }
  
  type EventBus struct {
      subscribers map[string][]EventHandler
      mu          sync.RWMutex
  }
  
  type EventHandler func(event Event) error
  ```

- [x] **–°–æ–±—ã—Ç–∏—è –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π**
  - `booking_created` ‚Äî –Ω–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  - `booking_confirmed` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
  - `booking_cancelled` ‚Äî –æ—Ç–º–µ–Ω–µ–Ω–æ
  - `booking_completed` ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–æ
  - `booking_item_changed` ‚Äî –∏–∑–º–µ–Ω–µ–Ω –∞–ø–ø–∞—Ä–∞—Ç
  - [x] –ü–æ–¥–ø–∏—Å–∫–∞ EventBus -> SheetsWorker (upsert/status), –∑–∞–º–µ–Ω–∞ –ø—Ä—è–º—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏–∑ –±–æ—Ç–∞
  - `booking_created` ‚Äî –Ω–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  - `booking_confirmed` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º
  - `booking_cancelled` ‚Äî –æ—Ç–º–µ–Ω–µ–Ω–æ
  - `booking_completed` ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–æ
  - `booking_item_changed` ‚Äî –∏–∑–º–µ–Ω–µ–Ω –∞–ø–ø–∞—Ä–∞—Ç

### 1.3.3 –ó–∞—â–∏—Ç–∞ –æ—Ç data race
- [x] **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**
  ```go
  func (db *DB) CreateBookingWithLock(ctx context. Context, booking *models.Booking) error {
      tx, err := db. BeginTx(ctx, nil)
      if err != nil {
          return err
      }
      defer tx.Rollback()
      
      // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
      available, err := checkAvailabilityTx(tx, booking.ItemID, booking.Date)
      if err != nil || !available {
          return ErrNotAvailable
      }
      
      // 2. –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
      err = createBookingTx(tx, booking)
      if err != nil {
          return err
      }
      
      // 3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –æ—á–µ—Ä–µ–¥—å
      err = createSyncTaskTx(tx, booking)
      if err != nil {
          return err
      }
      
      return tx.Commit()
  }
  ```

- [x] **–î–æ–±–∞–≤–∏—Ç—å optimistic locking –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π**
  ```sql
  ALTER TABLE bookings ADD COLUMN version INTEGER DEFAULT 1;
  ```
  
  ```go
  func (db *DB) UpdateBookingWithVersion(ctx context.Context, booking *models. Booking) error {
      result, err := db.ExecContext(ctx, 
          `UPDATE bookings SET status = ?, version = version + 1, updated_at = ? 
           WHERE id = ?  AND version = ?`,
          booking.Status, time.Now(), booking.ID, booking.Version)
      
      rows, _ := result.RowsAffected()
      if rows == 0 {
          return ErrConcurrentModification
      }
      return nil
  }
  ```

---

## 1.4 –£–ª—É—á—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 1.4.1 –•—Ä–∞–Ω–µ–Ω–∏–µ items –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- [x] **–°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É items**
  ```sql
  CREATE TABLE IF NOT EXISTS items (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      name TEXT UNIQUE NOT NULL,
      description TEXT,
      total_quantity INTEGER NOT NULL DEFAULT 1,
      sort_order INTEGER NOT NULL DEFAULT 0,
      is_active BOOLEAN DEFAULT 1,
      created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
      updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
  );
  CREATE INDEX IF NOT EXISTS idx_items_sort ON items(sort_order, id);
  ```

- [x] **CRUD –¥–ª—è items**
  ```go
  func (db *DB) GetActiveItems(ctx context. Context) ([]models.Item, error)
  func (db *DB) CreateItem(ctx context.Context, item *models.Item) error
  func (db *DB) UpdateItem(ctx context. Context, item *models.Item) error
  func (db *DB) ReorderItem(ctx context.Context, id int64, newOrder int64) error
  func (db *DB) DeactivateItem(ctx context.Context, id int64) error
  ```

- [x] **–ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è items (—Ç–æ–ª—å–∫–æ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤)**
  - `/add_item <name> <quantity>` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∞–ø–ø–∞—Ä–∞—Ç
  - `/edit_item <name> <new_quantity>` ‚Äî –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
  - `/list_items` ‚Äî —Å–ø–∏—Å–æ–∫ –∞–ø–ø–∞—Ä–∞—Ç–æ–≤
  - `/disable_item <name>` ‚Äî –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
  - `/set_item_order <name> <order>` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –≤—ã–≤–æ–¥–∞
  - `/move_item_up <name>` / `/move_item_down <name>` ‚Äî –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ —Å —Å–æ—Å–µ–¥–Ω–∏–º

---

# üìå –ß–ê–°–¢–¨ 2: –ù–æ–≤—ã–π –±–æ—Ç (bronivik_crm)

## 2.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–æ–≤–æ–≥–æ –±–æ—Ç–∞

### 2.1.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
bronivik_crm/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ bot/
‚îÇ       ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ configs/
‚îÇ   ‚îî‚îÄ‚îÄ config.yaml
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ client.go          # –ö–ª–∏–µ–Ω—Ç –¥–ª—è API bronivik_jr
‚îÇ   ‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handler.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manager.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cabinet_handler.go # –†–∞–±–æ—Ç–∞ —Å –∫–∞–±–∏–Ω–µ—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ booking_handler.go # –ü–æ—á–∞—Å–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database. go
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cabinet.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cabinet_schedule.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hourly_booking.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.go
‚îÇ   ‚îú‚îÄ‚îÄ google/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sheets.go
‚îÇ   ‚îî‚îÄ‚îÄ worker/
‚îÇ       ‚îî‚îÄ‚îÄ sync_worker.go
‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ go. sum
‚îî‚îÄ‚îÄ Dockerfile
```

### 2.1.2 –û—Å–Ω–æ–≤–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

#### –ö–∞–±–∏–Ω–µ—Ç—ã (Cabinets)
- [x] **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `internal/models/cabinet. go`**
  ```go
  package models
  
  import "time"
  
  type Cabinet struct {
      ID          int64     `json:"id"`
      Name        string    `json:"name"`
      Description string    `json:"description"`
      IsActive    bool      `json:"is_active"`
      CreatedAt   time.Time `json:"created_at"`
      UpdatedAt   time. Time `json:"updated_at"`
  }
  ```

#### –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–æ–≤ (Cabinet Schedule)
- [x] **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `internal/models/cabinet_schedule. go`**
  ```go
  package models
  
  import "time"
  
  type CabinetSchedule struct {
      ID         int64     `json:"id"`
      CabinetID  int64     `json:"cabinet_id"`
      DayOfWeek  int       `json:"day_of_week"` // 0-6 (Sunday-Saturday)
      StartTime  string    `json:"start_time"`  // "09:00"
      EndTime    string    `json:"end_time"`    // "18:00"
      SlotDuration int     `json:"slot_duration"` // –≤ –º–∏–Ω—É—Ç–∞—Ö (60)
      IsActive   bool      `json:"is_active"`
      CreatedAt  time.Time `json:"created_at"`
      UpdatedAt  time.Time `json:"updated_at"`
  }
  
  // CabinetScheduleOverride –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–ø—Ä–∞–∑–¥–Ω–∏–∫–∏, –æ—Å–æ–±—ã–µ –¥–Ω–∏)
  type CabinetScheduleOverride struct {
      ID         int64     `json:"id"`
      CabinetID  int64     `json:"cabinet_id"`
      Date       time.Time `json:"date"`
      IsClosed   bool      `json:"is_closed"` // –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã—Ç
      StartTime  string    `json:"start_time"`
      EndTime    string    `json:"end_time"`
      Reason     string    `json:"reason"`
      CreatedAt  time.Time `json:"created_at"`
  }
  ```

#### –ü–æ—á–∞—Å–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `internal/models/hourly_booking.go`**
  ```go
  package models
  
  import "time"
  
  type HourlyBooking struct {
      ID           int64     `json:"id"`
      UserID       int64     `json:"user_id"`
      UserName     string    `json:"user_name"`
      UserNickname string    `json:"user_nickname"`
      Phone        string    `json:"phone"`
      CabinetID    int64     `json:"cabinet_id"`
      CabinetName  string    `json:"cabinet_name"`
      ItemID       int64     `json:"item_id"`      // ID –∞–ø–ø–∞—Ä–∞—Ç–∞ –∏–∑ bronivik_jr
      ItemName     string    `json:"item_name"`    // –ò–º—è –∞–ø–ø–∞—Ä–∞—Ç–∞
      Date         time.Time `json:"date"`
      StartTime    string    `json:"start_time"`   // "10:00"
      EndTime      string    `json:"end_time"`     // "11:00"
      Status       string    `json:"status"`       // pending, confirmed, cancelled, completed
      Comment      string    `json:"comment"`
      ClientName   string    `json:"client_name"`  // –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ (–¥–ª—è CRM)
      ClientPhone  string    `json:"client_phone"` // –¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞
      CreatedAt    time.Time `json:"created_at"`
      UpdatedAt    time.Time `json:"updated_at"`
  }
  ```

---

## 2.2 –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö CRM –±–æ—Ç–∞

### 2.2.1 –ú–∏–≥—Ä–∞—Ü–∏–∏
- [x] **–°–æ–∑–¥–∞—Ç—å `internal/database/database. go`**
  ```go
  func createTables(db *sql.DB) error {
      queries := []string{
          // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ bronivik_jr)
          `CREATE TABLE IF NOT EXISTS users (...)`,
          
          // –ö–∞–±–∏–Ω–µ—Ç—ã
          `CREATE TABLE IF NOT EXISTS cabinets (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              name TEXT UNIQUE NOT NULL,
              description TEXT,
              is_active BOOLEAN DEFAULT 1,
              created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
              updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
          )`,
          
          // –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–æ–≤
          `CREATE TABLE IF NOT EXISTS cabinet_schedules (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              cabinet_id INTEGER NOT NULL,
              day_of_week INTEGER NOT NULL, -- 0-6
              start_time TEXT NOT NULL,      -- "09:00"
              end_time TEXT NOT NULL,        -- "18:00"
              slot_duration INTEGER DEFAULT 60, -- –º–∏–Ω—É—Ç—ã
              is_active BOOLEAN DEFAULT 1,
              created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
              updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
              FOREIGN KEY (cabinet_id) REFERENCES cabinets(id),
              UNIQUE(cabinet_id, day_of_week)
          )`,
          
          // –ò—Å–∫–ª—é—á–µ–Ω–∏—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
          `CREATE TABLE IF NOT EXISTS cabinet_schedule_overrides (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              cabinet_id INTEGER NOT NULL,
              date DATE NOT NULL,
              is_closed BOOLEAN DEFAULT 0,
              start_time TEXT,
              end_time TEXT,
              reason TEXT,
              created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
              FOREIGN KEY (cabinet_id) REFERENCES cabinets(id),
              UNIQUE(cabinet_id, date)
          )`,
          
          // –ü–æ—á–∞—Å–æ–≤—ã–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
          `CREATE TABLE IF NOT EXISTS hourly_bookings (
              id INTEGER PRIMARY KEY AUTOINCREMENT,
              user_id INTEGER NOT NULL,
              user_name TEXT NOT NULL,
              user_nickname TEXT,
              phone TEXT,
              cabinet_id INTEGER NOT NULL,
              cabinet_name TEXT NOT NULL,
              item_id INTEGER, -- –∏–∑ bronivik_jr
              item_name TEXT,
              date DATE NOT NULL,
              start_time TEXT NOT NULL,
              end_time TEXT NOT NULL,
              status TEXT DEFAULT 'pending',
              comment TEXT,
              client_name TEXT,
              client_phone TEXT,
              created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
              updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
              version INTEGER DEFAULT 1,
              FOREIGN KEY (cabinet_id) REFERENCES cabinets(id)
          )`,
          
          // –û—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
          `CREATE TABLE IF NOT EXISTS sync_queue (...)`,
          
          // –ò–Ω–¥–µ–∫—Å—ã
          `CREATE INDEX IF NOT EXISTS idx_hourly_bookings_date ON hourly_bookings(date)`,
          `CREATE INDEX IF NOT EXISTS idx_hourly_bookings_cabinet ON hourly_bookings(cabinet_id)`,
          `CREATE INDEX IF NOT EXISTS idx_hourly_bookings_item ON hourly_bookings(item_id)`,
          `CREATE INDEX IF NOT EXISTS idx_hourly_bookings_status ON hourly_bookings(status)`,
          `CREATE INDEX IF NOT EXISTS idx_hourly_bookings_time ON hourly_bookings(date, start_time, end_time)`,
      }
      // ... 
  }
  ```

### 2.2.2 –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞–±–∏–Ω–µ—Ç–∞–º–∏
- [x] **CRUD –∫–∞–±–∏–Ω–µ—Ç–æ–≤**
  ```go
  func (db *DB) CreateCabinet(ctx context. Context, cabinet *models.Cabinet) error
  func (db *DB) GetCabinet(ctx context. Context, id int64) (*models.Cabinet, error)
  func (db *DB) GetActiveCabinets(ctx context. Context) ([]models.Cabinet, error)
  func (db *DB) UpdateCabinet(ctx context.Context, cabinet *models.Cabinet) error
  func (db *DB) DeactivateCabinet(ctx context.Context, id int64) error
  ```

### 2.2.3 –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
- [x] **CRUD —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è**
  ```go
  func (db *DB) SetCabinetSchedule(ctx context. Context, schedule *models.CabinetSchedule) error
  func (db *DB) GetCabinetSchedule(ctx context. Context, cabinetID int64) ([]models.CabinetSchedule, error)
  func (db *DB) GetCabinetScheduleForDay(ctx context.Context, cabinetID int64, dayOfWeek int) (*models.CabinetSchedule, error)
  func (db *DB) AddScheduleOverride(ctx context.Context, override *models.CabinetScheduleOverride) error
  func (db *DB) GetScheduleOverrides(ctx context. Context, cabinetID int64, startDate, endDate time.Time) ([]models.CabinetScheduleOverride, error)
  ```

### 2.2.4 –ú–µ—Ç–æ–¥—ã –¥–ª—è –ø–æ—á–∞—Å–æ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- [x] **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–ª–æ—Ç–∞**
  ```go
  // CheckSlotAvailability –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—Ç–∞
  func (db *DB) CheckSlotAvailability(ctx context.Context, cabinetID int64, date time.Time, startTime, endTime string) (bool, error) {
      // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ —Å–ª–æ—Ç –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è –∫–∞–±–∏–Ω–µ—Ç–∞
      // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ override –Ω–∞ —ç—Ç—É –¥–∞—Ç—É
      // 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
  }
  
  // GetAvailableSlots –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—Å–µ —Å–≤–æ–±–æ–¥–Ω—ã–µ —Å–ª–æ—Ç—ã –Ω–∞ –¥–∞—Ç—É
  func (db *DB) GetAvailableSlots(ctx context.Context, cabinetID int64, date time.Time) ([]TimeSlot, error)
  
  // TimeSlot —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å–ª–æ—Ç–∞
  type TimeSlot struct {
      StartTime string
      EndTime   string
      Available bool
  }
  ```

- [x] **–°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏**
  ```go
  func (db *DB) CreateHourlyBookingWithChecks(ctx context.Context, booking *models.HourlyBooking, bronivikClient *api.BronivikClient) error {
      tx, err := db. BeginTx(ctx, nil)
      if err != nil {
          return err
      }
      defer tx.Rollback()
      
      // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–∞–±–∏–Ω–µ—Ç–∞ –Ω–∞ –≤—Ä–µ–º—è
      available, err := checkSlotAvailabilityTx(tx, booking.CabinetID, booking.Date, booking. StartTime, booking. EndTime)
      if ! available {
          return ErrSlotNotAvailable
      }
      
      // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∞–ø–ø–∞—Ä–∞—Ç–∞ —á–µ—Ä–µ–∑ API bronivik_jr
      if booking.ItemID > 0 {
          itemAvailable, err := bronivikClient.CheckItemAvailability(booking.ItemName, booking.Date)
          if err != nil || !itemAvailable {
              return ErrItemNotAvailable
          }
      }
      
      // 3. –°–æ–∑–¥–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
      err = createHourlyBookingTx(tx, booking)
      if err != nil {
          return err
      }
      
      return tx.Commit()
  }
  ```

- [x] **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–ø–ø–∞—Ä–∞—Ç–∞ –∏ –¥–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ø–æ—á–∞—Å–æ–≤–æ–π –±—Ä–æ–Ω–µ**
  - [x] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è –≤ `hourly_bookings`: `item_name`, `client_name`, `client_phone`
  - [x] –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å `HourlyBooking` (CRM)
  - [x] –û–±–Ω–æ–≤–∏—Ç—å insert/select/scan –º–µ—Ç–æ–¥—ã –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
  - [x] –î–æ–±–∞–≤–∏—Ç—å backfill/ALTER TABLE –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –±–∞–∑

- [x] **–í–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ø—Ä–∞–≤–∏–ª–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (CRM)**
  - [x] –ù–µ–ª—å–∑—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –≤ –ø—Ä–æ—à–ª–æ–º; —É—á–µ—Å—Ç—å `min_advance_booking`
  - [x] –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ `slot_duration`
  - [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π –ø–æ –∫–∞–±–∏–Ω–µ—Ç—É (—É–∂–µ –µ—Å—Ç—å) + (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ª–∏–º–∏—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –±—Ä–æ–Ω–µ–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - [x] –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º/—Å–æ–∑–¥–∞–Ω–∏–µ–º (race condition)

---

## 2.3 –ö–ª–∏–µ–Ω—Ç API –¥–ª—è —Å–≤—è–∑–∏ —Å bronivik_jr

### 2.3.1 –ö–ª–∏–µ–Ω—Ç
- [x] **–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `internal/api/client.go`**
  ```go
  package api
  
  import (
      "context"
      "encoding/json"
      "fmt"
      "net/http"
      "time"
  )
  
  type BronivikClient struct {
      baseURL    string
      apiKey     string
      httpClient *http.Client
  }
  
  type AvailabilityResponse struct {
      Available   bool  `json:"available"`
      BookedCount int   `json:"booked_count"`
      Total       int   `json:"total"`
  }
  
  type Item struct {
      ID            int64  `json:"id"`
      Name          string `json:"name"`
      TotalQuantity int64  `json:"total_quantity"`
  }
  
  func NewBronivikClient(baseURL, apiKey string) *BronivikClient {
      return &BronivikClient{
          baseURL:  baseURL,
          apiKey:  apiKey,
          httpClient: &http.Client{
              Timeout: 10 * time.Second,
          },
      }
  }
  
  // CheckItemAvailability –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∞–ø–ø–∞—Ä–∞—Ç–∞
  func (c *BronivikClient) CheckItemAvailability(itemName string, date time. Time) (bool, error) {
      url := fmt.Sprintf("%s/api/v1/availability/%s? date=%s", 
          c.baseURL, itemName, date.Format("2006-01-02"))
      
      req, err := http.NewRequest("GET", url, nil)
      if err != nil {
          return false, err
      }
      req.Header.Set("X-API-Key", c.apiKey)
      
      resp, err := c. httpClient.Do(req)
      if err != nil {
          return false, err
      }
      defer resp.Body. Close()
      
      if resp.StatusCode != http.StatusOK {
          return false, fmt.Errorf("API returned status %d", resp.StatusCode)
      }
      
      var result AvailabilityResponse
      if err := json.NewDecoder(resp. Body).Decode(&result); err != nil {
          return false, err
      }
      
      return result.Available, nil
  }
  
  // GetItems –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–ø–ø–∞—Ä–∞—Ç–æ–≤
  func (c *BronivikClient) GetItems() ([]Item, error) {
      // ... 
  }
  
  // BulkCheckAvailability –º–∞—Å—Å–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
  func (c *BronivikClient) BulkCheckAvailability(items []string, dates []time.Time) (map[string]map[string]bool, error) {
      // ...
  }
  ```

### 2.3.2 –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [x] **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Redis**
  ```go
  type CachedBronivikClient struct {
      client      *BronivikClient
      redisClient *redis. Client
      cacheTTL    time.Duration
  }
  
  func (c *CachedBronivikClient) CheckItemAvailability(itemName string, date time.Time) (bool, error) {
      cacheKey := fmt. Sprintf("item_availability:%s:%s", itemName, date.Format("2006-01-02"))
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
      cached, err := c.redisClient.Get(ctx, cacheKey).Result()
      if err == nil {
          return cached == "true", nil
      }
      
      // –ó–∞–ø—Ä–æ—Å –∫ API
      available, err := c. client.CheckItemAvailability(itemName, date)
      if err != nil {
          return false, err
      }
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
      c.redisClient. Set(ctx, cacheKey, fmt.Sprintf("%t", available), c.cacheTTL)
      
      return available, nil
  }
  ```

---

## 2.4 Telegram Bot Handlers

### 2.4.1 –ö–æ–º–∞–Ω–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [x] **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã**
  - `/start` ‚Äî –Ω–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
  - `/book` ‚Äî —Å–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–∞
  - `/my_bookings` ‚Äî –º–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  - `/cancel_booking [ID]` ‚Äî –æ—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
  - `/help` ‚Äî —Å–ø—Ä–∞–≤–∫–∞

### 2.4.2 –ö–æ–º–∞–Ω–¥—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- [x] **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–∞–º–∏**
  - `/add_cabinet <name>` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç
  - `/list_cabinets` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–∞–±–∏–Ω–µ—Ç–æ–≤
  - `/cabinet_schedule <cabinet_id>` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
  - `/set_schedule <cabinet_id> <day> <start> <end>` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
  - `/close_cabinet <cabinet_id> <date> [reason]` ‚Äî –∑–∞–∫—Ä—ã—Ç—å –∫–∞–±–∏–Ω–µ—Ç –Ω–∞ –¥–∞—Ç—É
  
- [x] **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏**
  - `/pending` ‚Äî –æ–∂–∏–¥–∞—é—â–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  - `/approve [ID]` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
  - `/reject [ID]` ‚Äî –æ—Ç–∫–ª–æ–Ω–∏—Ç—å
  - `/today_schedule` ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
  - `/tomorrow_schedule` ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞

### 2.4.3 –°—Ü–µ–Ω–∞—Ä–∏–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- [x] **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å flow –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
  ```
  1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:  /book
  2. –ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–±–∏–Ω–µ—Ç [–∏–Ω–ª–∞–π–Ω –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–∞–±–∏–Ω–µ—Ç–∞–º–∏]
  3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞–±–∏–Ω–µ—Ç]
  4. –ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ –∞–ø–ø–∞—Ä–∞—Ç (–∏–ª–∏ "–ë–µ–∑ –∞–ø–ø–∞—Ä–∞—Ç–∞") [–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞]
     - –ë–æ—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∞–ø–ø–∞—Ä–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ API bronivik_jr
     - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã
  5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–≤—ã–±–∏—Ä–∞–µ—Ç –∞–ø–ø–∞—Ä–∞—Ç]
  6. –ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É [–∫–∞–ª–µ–Ω–¥–∞—Ä—å]
  7. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–≤—ã–±–∏—Ä–∞–µ—Ç –¥–∞—Ç—É]
  8. –ë–æ—Ç:  –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è [—Å–ª–æ—Ç—ã —Å —É—á–µ—Ç–æ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∫–∞–±–∏–Ω–µ—Ç–∞ –ò –∞–ø–ø–∞—Ä–∞—Ç–∞]
  9. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:  [–≤—ã–±–∏—Ä–∞–µ—Ç –≤—Ä–µ–º—è]
  10. –ë–æ—Ç:  –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞ (–§–ò–û, —Ç–µ–ª–µ—Ñ–æ–Ω)
  11. –ë–æ—Ç: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  12. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
  ```

- [x] **UX –∏ —Å—Ç–∞—Ç—É—Å—ã (CRM)**
  - [x] –ò–Ω–ª–∞–π–Ω-–∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
  - [x] –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ: —Å–ª–æ—Ç –∑–∞–Ω—è—Ç / –∞–ø–ø–∞—Ä–∞—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
  - [x] –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–±–æ—Ä —à–∞–≥–∞ (–∞–ø–ø–∞—Ä–∞—Ç/–¥–∞—Ç–∞/–≤—Ä–µ–º—è) –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è

- [x] **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (CRM)**
  - [x] Get-or-create –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `telegram_id` –≤ –ë–î
  - [x] –•—Ä–∞–Ω–∏—Ç—å `username/first_name/last_name/phone` (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)

### 2.4.4 –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏
- [x] **–°–æ–∑–¥–∞—Ç—å `internal/bot/calendar.go`**
  ```go
  // GenerateCalendarKeyboard —Å–æ–∑–¥–∞–µ—Ç –∏–Ω–ª–∞–π–Ω-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è
  func GenerateCalendarKeyboard(year, month int, availableDates map[string]bool) tgbotapi. InlineKeyboardMarkup
  
  // GenerateTimeSlotsKeyboard —Å–æ–∑–¥–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏
  func GenerateTimeSlotsKeyboard(slots []TimeSlot, selectedDate string) tgbotapi.InlineKeyboardMarkup
  ```

---

## 2.5 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è CRM –±–æ—Ç–∞

### 2.5.1 –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [x] **–°–æ–∑–¥–∞—Ç—å `configs/config.yaml`**
  ```yaml
  app:
    name:  "bronivik-crm"
    environment: "staging"
    version: "1.0.0"
  
  telegram:
    bot_token: ${CRM_BOT_TOKEN}
    debug: true
  
  database: 
    path: "./data/crm.db"
    postgres:
      host:  ${POSTGRES_HOST}
      user: ${POSTGRES_USER}
      password: ${POSTGRES_PASSWORD}
      database: "bronivik_crm"
  
  redis:
    host: ${REDIS_HOST}
    port: 6379
    password: ${REDIS_PASSWORD}
    db: 1
  
  bronivik_api:
    base_url: "http://bronivik-jr: 8081"
    api_key: ${BRONIVIK_API_KEY}
    timeout: 10s
    cache_ttl: 5m
  
  google: 
    credentials_file: ${GOOGLE_CREDENTIALS_FILE}
    spreadsheet_id: ${CRM_SPREADSHEET_ID}
  
  managers:
    - 123456789
    - 987654321
  
  booking: 
    default_slot_duration: 60  # –º–∏–Ω—É—Ç—ã
    min_advance_booking: 1     # –º–∏–Ω–∏–º—É–º –∑–∞ 1 —á–∞—Å –¥–æ –Ω–∞—á–∞–ª–∞
    max_advance_days: 30       # –º–∞–∫—Å–∏–º—É–º –Ω–∞ 30 –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥
    allow_multiple_slots: true # —Ä–∞–∑—Ä–µ—à–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–ª–æ—Ç–æ–≤ –ø–æ–¥—Ä—è–¥
  ```

---

## 2.6 Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### 2.6.1 Dockerfile
- [x] **–°–æ–∑–¥–∞—Ç—å `Dockerfile`**
  ```dockerfile
  FROM golang: 1.21-alpine AS builder
  
  WORKDIR /app
  COPY go.mod go.sum ./
  RUN go mod download
  COPY .  .
  RUN CGO_ENABLED=0 GOOS=linux go build -o /bronivik-crm ./cmd/bot
  
  FROM alpine:latest
  RUN apk --no-cache add ca-certificates tzdata
  WORKDIR /app
  COPY --from=builder /bronivik-crm .
  COPY configs/ ./configs/
  
  CMD ["./bronivik-crm", "--config=configs/config.yaml"]
  ```

### 2.6.2 Docker Compose –¥–ª—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã
- [x] **–°–æ–∑–¥–∞—Ç—å `docker/docker-compose.yml`**
  ```yaml
  version:  '3.8'
  
  services:
    bronivik-jr:
      build: 
        context: ../bronivik_jr
        dockerfile: Dockerfile
      environment:
        - BOT_TOKEN=${JR_BOT_TOKEN}
        - GOOGLE_CREDENTIALS_FILE=/app/credentials.json
      volumes:
        - jr-data:/app/data
        - ./credentials.json:/app/credentials.json:ro
      ports:
        - "8081:8081"  # API endpoint
      networks:
        - bronivik-network
      depends_on:
        - redis
        - postgres
  
    bronivik-crm:
      build: 
        context: ../bronivik_crm
        dockerfile: Dockerfile
      environment:
        - CRM_BOT_TOKEN=${CRM_BOT_TOKEN}
        - BRONIVIK_API_KEY=${BRONIVIK_API_KEY}
        - GOOGLE_CREDENTIALS_FILE=/app/credentials. json
      volumes: 
        - crm-data:/app/data
        - ./credentials.json:/app/credentials.json:ro
      networks:
        - bronivik-network
      depends_on: 
        - bronivik-jr
        - redis
        - postgres
  
    postgres:
      image:  postgres:15-alpine
      environment: 
        - POSTGRES_USER=${POSTGRES_USER}
        - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
        - POSTGRES_DB=bronivik
      volumes:
        - postgres-data:/var/lib/postgresql/data
      networks:
        - bronivik-network
  
    redis: 
      image: redis: 7-alpine
      command: redis-server --appendonly yes
      volumes:
        - redis-data:/data
      networks: 
        - bronivik-network
  
  volumes:
    jr-data:
    crm-data: 
    postgres-data: 
    redis-data:
  
  networks:
    bronivik-network: 
      driver: bridge
  ```

---

# üìå –ß–ê–°–¢–¨ 3: –ú–∏–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## 3.1 –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### 3.1.1 –ú–∏–≥—Ä–∞—Ü–∏—è items –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- [x] **–°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ `scripts/migrate_items. go`**
  - –ß—Ç–µ–Ω–∏–µ items –∏–∑ config.yaml
  - –í—Å—Ç–∞–≤–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü—É items
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏

### 3.1.2 –ú–∏–≥—Ä–∞—Ü–∏—è —Å—Ö–µ–º—ã bronivik_jr
- [x] **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π**
  - `version` –¥–ª—è optimistic locking
  - –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 3.1.3 –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã bronivik_crm
- [x] **–ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è `hourly_bookings`**
  - `item_name`, `client_name`, `client_phone`
  - –ò–Ω–¥–µ–∫—Å—ã –ø–æ `cabinet_id,start_time,end_time,status`

## 3.2 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 3.2.1 Unit —Ç–µ—Å—Ç—ã
- [x] **–¢–µ—Å—Ç—ã –¥–ª—è database**
  - `database_test.go` ‚Äî —Ç–µ—Å—Ç—ã CRUD
  - `availability_test.go` ‚Äî —Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

- [ ] **–¢–µ—Å—Ç—ã –¥–ª—è API**
  - `api_test.go` ‚Äî —Ç–µ—Å—Ç—ã endpoints
  - `auth_test.go` ‚Äî —Ç–µ—Å—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

- [x] **–¢–µ—Å—Ç—ã –¥–ª—è API**
  - `api_test.go` ‚Äî —Ç–µ—Å—Ç—ã endpoints
  - `auth_test.go` ‚Äî —Ç–µ—Å—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

- [ ] **–¢–µ—Å—Ç—ã –¥–ª—è worker**
  - `worker_test.go` ‚Äî —Ç–µ—Å—Ç—ã –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á
  - `retry_test.go` ‚Äî —Ç–µ—Å—Ç—ã retry –ª–æ–≥–∏–∫–∏

- [x] **–¢–µ—Å—Ç—ã –¥–ª—è worker**
  - `worker_test.go` ‚Äî —Ç–µ—Å—Ç—ã –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á
  - `retry_test.go` ‚Äî —Ç–µ—Å—Ç—ã retry –ª–æ–≥–∏–∫–∏

### 3.2.2 Integration —Ç–µ—Å—Ç—ã
- [ ] **E2E —Ç–µ—Å—Ç—ã**
  - –°—Ü–µ–Ω–∞—Ä–∏–π –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Google Sheets
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –¥–≤—É—Ö –±–æ—Ç–æ–≤

### 3.2.3 Load —Ç–µ—Å—Ç—ã
- [ ] **–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
  - –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ —Å–ª–æ—Ç–∞
  - –ú–∞—Å—Å–æ–≤–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Sheets
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ rate limiting API

---

# üìå –ß–ê–°–¢–¨ 4: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## 4.1 –ú–µ—Ç—Ä–∏–∫–∏

### 4.1.1 Prometheus –º–µ—Ç—Ä–∏–∫–∏
- [x] **–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è bronivik_jr**
  - `bookings_total` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
  - `api_requests_total` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ API –∑–∞–ø—Ä–æ—Å–æ–≤
  - `sheets_sync_duration_seconds` ‚Äî –≤—Ä–µ–º—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
  - `sheets_sync_errors_total` ‚Äî –æ—à–∏–±–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

- [x] **–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è bronivik_crm**
- [x] **–ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è bronivik_crm**
  - `hourly_bookings_total`
  - `cabinet_occupancy_rate`
  - `bronivik_api_requests_total`
  - `bronivik_api_latency_seconds`

### 4.1.2 –ê–ª–µ—Ä—Ç—ã
- [x] **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã**
  - Sheets sync failed > 5 —Ä–∞–∑ –ø–æ–¥—Ä—è–¥
  - API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω > 1 –º–∏–Ω—É—Ç—ã
  - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

## 4.2 –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### 4.2.1 Structured logging
- [x] **–í–Ω–µ–¥—Ä–∏—Ç—å structured logging (zerolog/zap)**
  - Request ID –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞
  - –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
  - JSON —Ñ–æ—Ä–º–∞—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## 4.3 Healthchecks
- [x] **Health endpoints**
  - [x] `GET /healthz` (CRM)
  - [x] `GET /readyz` (CRM) ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ë–î/Redis/API

---

# üìå –ü–†–ò–û–†–ò–¢–ï–¢–´ –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

## –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è bronivik_jr (1-2 –Ω–µ–¥–µ–ª–∏)
1. ‚úÖ API endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
2. ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Google Sheets (worker)
3. ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç data race (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

## –§–∞–∑–∞ 2: –ë–∞–∑–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª bronivik_crm (2-3 –Ω–µ–¥–µ–ª–∏)
1. ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –º–æ–¥–µ–ª–∏
2. ‚úÖ –†–∞–±–æ—Ç–∞ —Å –∫–∞–±–∏–Ω–µ—Ç–∞–º–∏ –∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º
3. ‚úÖ –ö–ª–∏–µ–Ω—Ç API –¥–ª—è bronivik_jr
4. ‚úÖ –ë–∞–∑–æ–≤—ã–π flow –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

## –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ UI (1-2 –Ω–µ–¥–µ–ª–∏)
1. ‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –≤—ã–±–æ—Ä –≤—Ä–µ–º–µ–Ω–∏
2. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º
3. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets

## –§–∞–∑–∞ 4: –ü–æ–ª–∏—Ä–æ–≤–∫–∞ (1 –Ω–µ–¥–µ–ª—è)
1. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
2. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
3. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
4. ‚úÖ –î–µ–ø–ª–æ–π

---

# üìù –ó–ê–ú–ï–¢–ö–ò

## –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏** ‚Äî –µ—Å–ª–∏ –∞–ø–ø–∞—Ä–∞—Ç –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω –≤ bronivik_jr –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ bronivik_crm, –≤–æ–∑–º–æ–∂–µ–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç
   - –†–µ—à–µ–Ω–∏–µ:  —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

2. **Google API rate limits** ‚Äî –ø—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –æ–ø–µ—Ä–∞—Ü–∏–π
   - –†–µ—à–µ–Ω–∏–µ: batching –æ–ø–µ—Ä–∞—Ü–∏–π + exponential backoff

3. **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å** ‚Äî –µ—Å–ª–∏ bronivik_jr –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
   - –†–µ—à–µ–Ω–∏–µ:  –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ + graceful degradation (—Ä–∞–∑—Ä–µ—à–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –∞–ø–ø–∞—Ä–∞—Ç–∞)

## –£–ª—É—á—à–µ–Ω–∏—è –Ω–∞ –±—É–¥—É—â–µ–µ
- [ ] Telegram Mini App –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏
- [ ] –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞–º –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏
- [ ] –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ